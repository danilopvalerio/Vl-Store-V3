generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model caixa {
  id_caixa        String         @id(map: "pk_caixa") @default(uuid()) @db.Uuid
  id_loja         String         @db.Uuid
  status          String         @db.VarChar(20)
  saldo_inicial   Decimal?       @default(0) @db.Decimal(10, 2)
  saldo_final     Decimal?       @db.Decimal(10, 2)
  data_abertura   DateTime?      @default(now()) @db.Timestamp(6)
  data_fechamento DateTime?      @db.Timestamp(6)
  id_user_profile String         @db.Uuid
  loja            loja           @relation(fields: [id_loja], references: [id_loja], onDelete: NoAction, onUpdate: NoAction, map: "fk_caixa_loja")
  user_profile    user_profile   @relation(fields: [id_user_profile], references: [id_user_profile], onDelete: NoAction, onUpdate: NoAction, map: "fk_caixa_profile")
  movimentacao    movimentacao[]
  venda           venda[]
}

model cliente {
  id_cliente   String    @id(map: "pk_cliente") @default(uuid()) @db.Uuid
  nome         String    @db.VarChar(255)
  cpf_cnpj     String?   @unique(map: "uk_cliente_cpf") @db.VarChar(20)
  email        String?   @db.VarChar(255)
  telefone     String?   @db.VarChar(20)
  data_criacao DateTime? @default(now()) @db.Timestamp(6)
  venda        venda[]
}

model configuracoes_loja {
  id_config String  @id(map: "pk_config_loja") @default(uuid()) @db.Uuid
  id_loja   String  @db.Uuid
  chave     String  @db.VarChar(100)
  valor     String? @db.VarChar(255)
  loja      loja    @relation(fields: [id_loja], references: [id_loja], onDelete: Cascade, onUpdate: NoAction, map: "fk_config_loja")

  @@unique([id_loja, chave], map: "uk_config_chave_loja")
}

model endereco_loja {
  id_endereco String  @id(map: "pk_endereco_loja") @default(uuid()) @db.Uuid
  id_loja     String  @db.Uuid
  logradouro  String? @db.VarChar(255)
  numero      String? @db.VarChar(20)
  bairro      String? @db.VarChar(100)
  cep         String? @db.VarChar(20)
  complemento String? @db.VarChar(255)
  cidade      String? @db.VarChar(100)
  estado      String? @db.VarChar(50)
  loja        loja    @relation(fields: [id_loja], references: [id_loja], onDelete: Cascade, onUpdate: NoAction, map: "fk_end_loja")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model item_venda {
  id_item_venda        String           @id(map: "pk_item_venda") @default(uuid()) @db.Uuid
  id_venda             String           @db.Uuid
  id_variacao          String           @db.Uuid
  quantidade           Int
  preco_unitario       Decimal          @db.Decimal(10, 2)
  desconto_por_item    Decimal?         @default(0) @db.Decimal(10, 2)
  acrescimo_por_item   Decimal?         @default(0) @db.Decimal(10, 2)
  preco_final_unitario Decimal          @db.Decimal(10, 2)
  preco_subtotal       Decimal          @db.Decimal(10, 2)
  data_criacao         DateTime?        @default(now()) @db.Timestamp(6)
  produto_variacao     produto_variacao @relation(fields: [id_variacao], references: [id_variacao], onDelete: NoAction, onUpdate: NoAction, map: "fk_item_variacao")
  venda                venda            @relation(fields: [id_venda], references: [id_venda], onDelete: Cascade, onUpdate: NoAction, map: "fk_item_venda")
}

model log_acesso {
  id_log_acesso String    @id(map: "pk_log_acesso") @default(uuid()) @db.Uuid
  id_user       String?   @db.Uuid
  ip            String?   @db.VarChar(50)
  user_agent    String?   @db.VarChar(255)
  sucesso       Boolean?  @default(false)
  data          DateTime? @default(now()) @db.Timestamp(6)
  user          user?     @relation(fields: [id_user], references: [user_id], onUpdate: NoAction, map: "fk_log_acesso_user")
}

model log_sistema {
  id_log_sistema String    @id(map: "pk_log_sistema") @default(uuid()) @db.Uuid
  id_user        String?   @db.Uuid
  acao           String    @db.VarChar(255)
  detalhes       String?
  data           DateTime? @default(now()) @db.Timestamp(6)
  user           user?     @relation(fields: [id_user], references: [user_id], onUpdate: NoAction, map: "fk_log_user")
}

model loja {
  id_loja            String               @id(map: "pk_loja") @default(uuid()) @db.Uuid
  admin_user_id      String?              @db.Uuid
  nome               String               @db.VarChar(255)
  cnpj_cpf           String?              @db.VarChar(20)
  data_criacao       DateTime?            @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime?            @default(now()) @db.Timestamp(6)
  caixa              caixa[]
  configuracoes_loja configuracoes_loja[]
  endereco_loja      endereco_loja[]
  user               user?                @relation(fields: [admin_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_loja_admin")
  movimentacao       movimentacao[]
  produto            produto[]
  telefone_loja      telefone_loja[]
  user_profile       user_profile[]
  venda              venda[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model movimentacao {
  id_movimentacao    String    @id(map: "pk_movimentacao") @default(uuid()) @db.Uuid
  id_loja            String    @db.Uuid
  id_caixa           String    @db.Uuid
  id_venda           String?   @db.Uuid
  tipo               String    @db.VarChar(20)
  valor              Decimal   @db.Decimal(10, 2)
  descricao          String?   @db.VarChar(255)
  data_criacao       DateTime? @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime? @default(now()) @db.Timestamp(6)
  caixa              caixa     @relation(fields: [id_caixa], references: [id_caixa], onDelete: NoAction, onUpdate: NoAction, map: "fk_mov_caixa")
  loja               loja      @relation(fields: [id_loja], references: [id_loja], onDelete: NoAction, onUpdate: NoAction, map: "fk_mov_loja")
  venda              venda?    @relation(fields: [id_venda], references: [id_venda], onDelete: NoAction, onUpdate: NoAction, map: "fk_mov_venda")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model pagamento_venda {
  id_pagamento   String  @id(map: "pk_pagamento") @default(uuid()) @db.Uuid
  id_venda       String  @db.Uuid
  tipo_pagamento String  @db.VarChar(50)
  valor          Decimal @db.Decimal(10, 2)
  venda          venda   @relation(fields: [id_venda], references: [id_venda], onDelete: Cascade, onUpdate: NoAction, map: "fk_pagamento_venda")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model produto {
  id_produto         String             @id(map: "pk_produto") @default(uuid()) @db.Uuid
  id_loja            String             @db.Uuid
  referencia         String?            @unique(map: "uq_produto_referencia") @db.VarChar(100)
  nome               String             @db.VarChar(255)
  categoria          String?            @db.VarChar(100)
  material           String?            @db.VarChar(100)
  genero             String?            @db.VarChar(50)
  ativo              Boolean?           @default(true)
  data_criacao       DateTime?          @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime?          @default(now()) @db.Timestamp(6)
  loja               loja               @relation(fields: [id_loja], references: [id_loja], onDelete: Cascade, onUpdate: NoAction, map: "fk_produto_loja")
  produto_variacao   produto_variacao[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model produto_variacao {
  id_variacao        String       @id(map: "pk_produto_variacao") @default(uuid()) @db.Uuid
  id_produto         String       @db.Uuid
  nome               String?      @db.VarChar(255)
  descricao          String?
  quantidade         Int?         @default(0)
  valor              Decimal      @db.Decimal(10, 2)
  data_criacao       DateTime?    @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime?    @default(now()) @db.Timestamp(6)
  item_venda         item_venda[]
  produto            produto      @relation(fields: [id_produto], references: [id_produto], onDelete: Cascade, onUpdate: NoAction, map: "fk_variacao_produto")
}

model refresh_token {
  id_refresh_token String    @id(map: "pk_refresh_token") @default(uuid()) @db.Uuid
  id_user          String    @db.Uuid
  token            String    @unique(map: "uk_refresh_token") @db.VarChar(255)
  expiracao        DateTime  @db.Timestamp(6)
  criado_em        DateTime? @default(now()) @db.Timestamp(6)
  ativo            Boolean?  @default(true)
  user             user      @relation(fields: [id_user], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_refresh_user")
}

model telefone_loja {
  id_telefone_loja String @id(map: "pk_telefone_loja") @default(uuid()) @db.Uuid
  id_loja          String @db.Uuid
  telefone         String @db.VarChar(20)
  loja             loja   @relation(fields: [id_loja], references: [id_loja], onDelete: Cascade, onUpdate: NoAction, map: "fk_tel_loja")
}

model telefone_user {
  id_telefone String @id(map: "pk_telefone_user") @default(uuid()) @db.Uuid
  id_user     String @db.Uuid
  telefone    String @db.VarChar(20)
  user        user   @relation(fields: [id_user], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tel_user")
}

model user {
  user_id            String          @id(map: "pk_user") @default(uuid()) @db.Uuid
  email              String          @unique(map: "uk_user_email") @db.VarChar(255)
  senha_hash         String          @db.VarChar(255)
  ativo              Boolean         @default(true)
  data_criacao       DateTime?       @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime?       @default(now()) @db.Timestamp(6)
  log_acesso         log_acesso[]
  log_sistema        log_sistema[]
  loja               loja[]
  refresh_token      refresh_token[]
  telefone_user      telefone_user[]
  user_profile       user_profile[]
  venda              venda[]
}

model user_profile {
  id_user_profile    String    @id(map: "pk_user_profile") @default(uuid()) @db.Uuid
  user_id            String    @db.Uuid
  id_loja            String    @db.Uuid
  nome               String    @db.VarChar(255)
  cpf_cnpj           String?   @db.VarChar(20)
  cargo              String?   @db.VarChar(100)
  tipo_perfil        String?   @db.VarChar(50)
  ativo              Boolean?  @default(true)
  data_criacao       DateTime? @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime? @default(now()) @db.Timestamp(6)
  caixa              caixa[]
  loja               loja      @relation(fields: [id_loja], references: [id_loja], onDelete: Cascade, onUpdate: NoAction, map: "fk_profile_loja")
  user               user      @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_profile_user")

  @@unique([id_loja, cpf_cnpj], map: "uk_profile_loja_cpf")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model venda {
  id_venda           String            @id(map: "pk_venda") @default(uuid()) @db.Uuid
  id_loja            String            @db.Uuid
  id_caixa           String?           @db.Uuid
  id_user            String            @db.Uuid
  id_cliente         String?           @db.Uuid
  data               DateTime?         @default(dbgenerated("CURRENT_DATE")) @db.Date
  hora               DateTime?         @default(dbgenerated("CURRENT_TIME")) @db.Time(6)
  desconto           Decimal?          @default(0) @db.Decimal(10, 2)
  acrescimo          Decimal?          @default(0) @db.Decimal(10, 2)
  status             String?           @default("PENDENTE") @db.VarChar(20)
  total_final        Decimal           @db.Decimal(10, 2)
  valor_pago         Decimal           @db.Decimal(10, 2)
  data_criacao       DateTime?         @default(now()) @db.Timestamp(6)
  ultima_atualizacao DateTime?         @default(now()) @db.Timestamp(6)
  item_venda         item_venda[]
  movimentacao       movimentacao[]
  pagamento_venda    pagamento_venda[]
  caixa              caixa?            @relation(fields: [id_caixa], references: [id_caixa], onDelete: NoAction, onUpdate: NoAction, map: "fk_venda_caixa")
  cliente            cliente?          @relation(fields: [id_cliente], references: [id_cliente], onDelete: NoAction, onUpdate: NoAction, map: "fk_venda_cliente")
  loja               loja              @relation(fields: [id_loja], references: [id_loja], onDelete: NoAction, onUpdate: NoAction, map: "fk_venda_loja")
  user               user              @relation(fields: [id_user], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_venda_user")
}
